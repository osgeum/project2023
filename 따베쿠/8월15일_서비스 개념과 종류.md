kubernetes service(api) 개념

동일한 서비스를 제공하는 Pod 그룹의 단일 진입점을 제공

쿠버야 nginx웹 서버3개 webui 이름으로 실행해줘 -> api는 요청을 받고 deployment 문법을 체크, etcd에 있는 node1,node2,node3 정보를 수집,보존
-> 컨트롤러, 스케쥴러의 도음을 받아 웹서비스 3개를 실행(컨트롤러는 파드 3개를 보장, 롤링 업데이트, 롤백 )

노드에 작업을 분산하기 위해서 API에게 서비스를 요청 ( 쿠버야 webui 파드들을 하나의 IP로 묶어서 관리해줘~) = 단일 진입점
쿠버네티스는 파드들의 레이블을 기준으로 하나로 묶음 ( app:webui 레이블 ), Virtual IP 생성( IP 정할수도 있고, 정하지 않을수도 있음 보통은 랜덤 IP 사용) = 단일 집입점 = Loadbalance IP 

Deployment-definition                               Service-definition
                                         
apiVersion:apps/v1                                  apiVersion: v1
metadata:                                           metadata:
  name: webui                                         name: webui-svc
spec:                                               spec:
  replicas:3                                          clusterIP: 10.96.10.100 (생략가능,보통 생략) = Virtual IP = Loadbalance IP
  selector:                                           selector:
    matchLables:                                        app: webui
	  app: webui                                      ports:
  template:                                           - protocol: TCP
    metadata:                                           port: 80
	  name: nginx-Pod                                   targetPort: 80
	  labels:
	    app: webui
	spec:
	  containers:
	  - name:nginx-containers
	    image:nginx:1.14

kubernetes service 타입

4가지 타입

- clusterIP (Default)
Pod 그룹의 단일 진입점(Virtual IP생성)

- NodePort
ClusterIP 기본적으로 포함, 워커노드의 포트가 오픈(LoadBalncer) = 오픈된 워커노드의 IP:포트 접근시 파드에서버 제공하는 웹서비스 접근이 분산됨.
Cluster가 생성된후
모든 Worker Node에 외부에서 접속 가능한 포트가 예약

- LoadBalncer
ClusterIP 기본적으로 포함, 워커노드의 포트가 오픈(LoadBalncer) - 외부에 로드밴런서 배치 ( GCP,AWS,AZURE ) 에서만 사용 가능.
클라우드 인프라스트럭처(AWS, Azure, GCP 등)나 오픈스택 클라우드에 적용
LoadBalancer를 자동으로 프로 비전하는 기능 지원.

- ExteralName
클러스터 안에서 외부에 접속시 사용할 도메인을 등록해서 사용.
클러스터 도메인이 실제 외부 도메인으로 치환되어 동작.