#
Controller란
Pod의 개수를 보장

ReplicationController
- 요구하는 Pod의 개수를 보장하며 파드 집합의 실행을 항상 안정적으로 유지하는 것을 목표
- 요구하는 Pod의 개수가 부족하면 template를 이용해 Pod를 추가
- 요구하는 Pod의 수 보다 많으면 최근에 생성된 Pod를 삭제

기본 구성
- selector
- replicas
- template

#kubectl create deployment webui --image=nginx --replicas=3
쿠버야 나 nginx 웹서버 3개 실행해줘!

#kubectl create rc-exam --image=nginx --replicas=3 --selector=app=webui
쿠버야 nginx 웹서버 3개 실행해줘!

# kubectl get replicationcontrollers
리플리케이션 컨트롤러 확인
# kubectl describe replicationcontrollers rc-nginx
리플리케이션 컨트롤러 자세히 보기
# kubectl get pod --show-labels
파드 라벨 확인
# kubectl edit replicationcontrollers rc-nginx
편집하기
# kubectl scale replicationcontroller rc-nginx --replicas=4
스케일업
# kubectl scale replicationcontroller rc-nginx --replicas=2
스케일다운
# kubectl delete replicationcontrollers rc-nginx 
리플리케이션 컨트롤러 삭제

문제

1. 다음의 조건으로 ReplicationController를 사용하는 rc-lab.yaml 파일을생성하고 동작시킵니다.
- labels(name:apache,app:main,rel:stable)를 가지는 httpd:2.2 버전의 Pod를 2개 운영합니다.
- rc name: rc-mainui
- container : httpd:2.2
- 현재 디렉토리에 rc-lab.yaml 파일이 생성되어야 하고, 애플리케이션 동작은 파일을 이용해 실행합니다.

apiVersion: v1
kind: ReplicationController
metadata:
  name: rc-mainui
spec:
  replicas: 2
  selector:
    app: main
  template:
    metadata:
      labels:
        app: main
        name: apache
        rel: stable
    spec:
      containers:
      - name: httd
        image: httpd:2.2
		

2. 동작되는 httpd:2.2 버전의 컨테이너를 3개로 확장하는 명령을 적고 실행하세요.
# kubectl scale replicationcontroller rc-mainui --replicas=3

ReplicaSet 
ReplicationController와 성격은 동일
파드위 개수를 보장하며

차이점
ReplicationController 보다 풍부한 selector

  selector:
    matchLables:
	  component: redis
	matchExpressions:
     - {key: tier, operator: in, values: [cache]}
     - {key: environment, operator: NotIn, values: [dev]}
	 
matchExpressions 연산자
    In : key와 values를 지정하여 key, value가 일치하는 Pod만 연결
	NotIn: key는 일치하고 value는 일치하지 않는 Pod에 연결
	Exists: key에 맞는 lable의 pod를 연결
	DoesNotExist: key와 다른 label의 pod를 연결
	
예제

ReplicationController                                            ReplicaSet        
spec:                                                            spec:
 replicas: 3                                                      replicas: 3
 selector:                                                        selector:
  app: webui                                                        matchLabels:
  version: "2.1"                                                     app: webui
                                                                    matchExpressions:
app은 webui이고 version은 2.1 인 파드 3개 만들어죠. (and 조건)                  - {key:version,operator:In, values: ["2.1"]}
                                                                   app는 webui 이고 version은 2.1 인 파드 3개 만들어죠.

ReplicationController                                            ReplicaSet
spec:                                                            spec:
 replicas: 3                                                      replicas: 3
 selector:                                                        selector:
  app: webui                                                        matchLabels:
  version: "2.1"                                                     app: webui
                                                                    matchExpressions:
app은 webui이고 version은 2.1 인 파드 3개 만들어죠. (and 조건)                  - {key:version,operator:In, values: ["2.1"],["2.2"]}
                                                                    app는 webui 이고 version은 2.1 이든 2.2 인 파드 3개 만들어죠.
																	
ReplicationController											 ReplicaSet        
spec:                                                            spec:
 replicas: 3                                                      replicas: 3
 selector:                                                        selector:
  app: webui                                                        matchLabels:
  version: "2.1"                                                     app: webui
                                                                    matchExpressions:
app은 webui이고 version은 2.1 인 파드 3개 만들어죠. (and 조건)                  - {key:version,operator:NotIn, values: ["2.1"],["2.2"]}
                                                                    app는 webui 이고 version은 2.1 or 2.2 가 아닌 파드 3개 만들어죠.
																	
ReplicationController											 ReplicaSet        
spec:                                                            spec:
 replicas: 3                                                      replicas: 3
 selector:                                                        selector:
  app: webui                                                        matchLabels:
  version: "2.1"                                                     app: webui
                                                                    matchExpressions:
app은 webui이고 version은 2.1 인 파드 3개 만들어죠. (and 조건)                  - {key:version,operator:Exists}
                                                                    app는 webui 이고 version이 존재하는파드 3개 만들어죠.	

ReplicationController											 ReplicaSet        
spec:                                                            spec:
 replicas: 3                                                      replicas: 3
 selector:                                                        selector:
  app: webui                                                        matchLabels:
  version: "2.1"                                                     app: webui
                                                                    matchExpressions:
app은 webui이고 version은 2.1 인 파드 3개 만들어죠. (and 조건)                  - {key:version,operator:DoesNotExists}
                                                                    app는 webui 이고 version이 존재하지않는 파드 3개 만들어죠.					



ReplicationController definition                                  ReplicaSet definition
apiVersion: v1                                                    apiVersion: apps/v1
kind: ReplicationController                                       kind: RelicaSet
metadata:                                                         metadata:
 name: rc-nginx                                                    name: rc-nginx
spec:                                                             spec:
 replicas: 3                                                       replicas: 3
 selector:                                                         selector:
   app: webui                                                       matchlabels:
 template:                                                            app: webui
   metadata:                                                       template:
    name: nginx-pod                                                  metadata:
	labels:                                                           name: nginx-pod
	  app:webui                                                       labels:
	spec:                                                               app:webui
	 containers:                                                      spec:
	 - name: nginx-container                                           containers:
	   image: nginx:1.14                                               - name: nginx-container
																	     image: nginx:1.
						
# kubectl create -f rs-nginx.yaml

# kubectl get replicasets

# kubectl scale replicaset rs-nginx --replicas=2

# kubectl delete replicasets rs-nginx --cascade=false

# kubectl delete replicasets rs-nginx --cascade=orphan

1. 다음의 조건으로 ReplicaSet을 사용하는 rs-lab.yaml 파일을 생성하고 동작시킵니다.
   - labels(name: apache, app:main, rel:stable) 를 가지는 httpd:2.2 버전의 Pod를 2개 운영합니다.
     - rs name: rs-mainui
	 - container: httpd:2.2
   - 현재 디렉토리에 rs-lab.yaml 파일이 생성되어야하고, 애플리케이션 동작은 파일을 이용해 실행 합니다.

apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: rs-mainui
  labels:
    name: apache 
    app: main
    rel: stable
spec:
  replicas: 2
  selector:
    matchLabels:
      name: apache
      app: main
      rel: stable
  template:
    metadata:
      labels:
        name: apache
        app: main
        rel: stable 
    spec:
      containers:
      - name: httpd-container
        image: httpd:2.2
		
 
2. 동작되는 httpd:2.2 버전의 컨테이너를 1개로 축소하는 명령을 적고 실행하세요.

# kubectl scale replicaset rs-mainui --replicas=1

